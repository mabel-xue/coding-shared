# Whatâ€™s Improvement

## rxjsçš„æœ€ä½³å®è·µ | æœ€ä½³å®è·µ/rxjs

### é¿å…å†…å­˜æ³„æ¼

> ç®¡ç†è®¢é˜…éå¸¸é‡è¦ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨å–æ¶ˆè®¢é˜…ç°æœ‰è®¢é˜…ä»¥é¿å…å†…å­˜æ³„æ¼ã€‚å¤„ç†æ­¤é—®é¢˜çš„ä¸€ç§å¾ˆé…·çš„æ–¹æ³•æ˜¯ä½¿ç”¨æˆ‘ä»¬æ¥ä¸‹æ¥åœ¨ngOnDestroy()Angular çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­çš„Subject ï¼š

```JS
class AppComponent implements OnInit, OnDestroy {
  destroy$ = new Subject();
  ngOnInit() {
    const interval$ = interval(1000);
    interval$
      .pipe(takeUntil(this.destroy$))
      .subscribe(r => console.log(r));
  }

  ngOnDestroy() {
    this.destroy$.next(true);
  }
}
```

### é¿å…åµŒå¥—è®¢é˜…

> åµŒå¥—è®¢é˜…æ˜¯éœ€è¦å°½å¯èƒ½é¿å…çš„ã€‚å®ƒä½¿ä»£ç ä¸å¯è¯»ï¼Œå¤æ‚å¹¶å¼•å…¥å‰¯ä½œç”¨ã€‚å»ºè®®ä½¿ç”¨åƒæˆ–æ›´é«˜é˜¶çš„æµã€‚å¦‚ï¼š```mergeMap``` ```switchMap```

```js
class AppComponent {
  user: User;
  constructor(
    private route: ActivatedRoute,
    private userService: UserService)
  {
    this.route.params
      .pipe(
        map(v => v.id),
        switchMap(id => this.userService.fetchById(id))
      )
      .subscribe(user => this.user = user)
  }
}
```

ğŸ’¬[blog-ä½¿ç”¨ RxJS å¤„ç†å¤šä¸ª Http è¯·æ±‚](https://www.ctolib.com/topics-120325.html)

### åœ¨Angularä¸­é¿å…æ‰‹åŠ¨è®¢é˜…

> Angularæœ‰è¿™ä¸ªè¶…é…·çš„åŠŸèƒ½å«åšasync pipeã€‚å®ƒç”¨äºç›´æ¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æµã€‚å¼‚æ­¥ç®¡é“ä¸ºæˆ‘ä»¬åšäº†ä¸‰ä»¶äº‹ï¼š
> å®ƒè®¢é˜…æµå¹¶å°†å€¼ä¼ é€’ç»™ç»„ä»¶
> å®ƒåœ¨ç»„ä»¶è¢«é”€æ¯æ—¶è‡ªåŠ¨å–æ¶ˆè®¢é˜…ï¼ˆåˆ é™¤äº†å¤§é‡å–æ¶ˆè®¢é˜…é€»è¾‘ï¼‰
> è§¦å‘å™¨è‡ªåŠ¨æ›´æ”¹æ£€æµ‹
> è¿™æ„å‘³ç€æˆ‘ä»¬ä¸å¿…å†æ‰‹åŠ¨è®¢é˜…æˆ–å–æ¶ˆè®¢é˜…ã€‚

```js
@Component({
    ...
    template: `
        <user-detail [user]="user$|async"></user-detail>
    `
})
class AppComponent {
    user$ = this.route.params.pipe(
        map(v => v.id),
        switchMap(id => this.userService.fetchById(id))
    );

    constructor(
        private route: ActivatedRoute,
        private userService: UserService) {
    }
}
```

ğŸ’¬[blog-rxjs-best-practices-in-angular](https://blog.strongbrew.io/rxjs-best-practices-in-angular/)
