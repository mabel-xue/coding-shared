# Whatâ€™s Improvement

## ng-templateçš„ä½¿ç”¨ | Angular/ng-Alain

### åœºæ™¯

åœ¨ä¸­å°é¡¹ç›®ä¸­ï¼Œæˆ‘æŠŠalain curdè¡¨æ ¼å°è£…èµ·æ¥ï¼Œå°è£…åçš„ä½¿ç”¨ç¤ºä¾‹ï¼š

```html
<btx-curd-list #list title="äº§å“ç®¡ç†"
  [url]="url"
  [columns]="columns"
  [scroll]="scroll"
  [searchSchema]="searchSchema"
  [service]="product"
  [editComponent]="editComponent"
  [viewComponent]="viewComponent"></btx-curd-list>
```

ä½†å½“è¡¨æ ¼æœç´¢ç»„ä»¶ä¸º'custom'æ—¶ï¼Œéœ€è¦æ·»åŠ è‡ªå®šä¹‰customè¡¨å•é¡¹ä»£ç ï¼Œè€Œæœªå°è£…çš„ä½¿ç”¨ç¤ºä¾‹ä¸ºï¼š

```html
<sf [className]="'search-bottons-right-alain'" mode="search" [schema]="searchSchema" [ui]="searchUiSchema" (formSubmit)="st.reset($event)" (formReset)="st.reset($event)">
  <ng-template sf-template="productCode" let-me let-ui="searchUiSchema" let-schema="searchSchema">
    <nz-select [ngModel]="me.formProperty.value" (ngModelChange)="me.setValue($event)">
      <nz-option
        nzCustomContent
        *ngFor="let i of dict.productList$ | async"
        [nzLabel]="i.value"
        [nzValue]="i.value" ><span>{{i.value}} ({{i.label}})</span></nz-option>
    </nz-select>
  </ng-template>
</sf>
```

è¿™é‡Œæˆ‘ä»¬ä¸èƒ½å°† ```ng-template``` çš„éƒ¨åˆ†ç›´æ¥åŠ åˆ° ```btx-curd-list``` çš„ä»£ç ä¸­ï¼Œè€Œåº”è¯¥é€šè¿‡è®¾ç½®```ngTemplateOutlet```æ”¯æŒè‡ªå®šä¹‰æ¨¡æ¿ï¼Œ

å¦‚ä¸‹ï¼Œåœ¨ CurdListComponent ä¸­å®ç°å¯¹ SFComponent çš„ ng-template æ”¯æŒï¼š

```html
<sf mode="search"
  [schema]="schema"
  [ui]="ui"
  (formSubmit)="st.reset($event)"
  (formReset)="st.reset($event)">
  <ng-template *ngFor="let item of _customTemplates"
    [sf-template]="item.name"
    let-me
    let-ui="ui"
    let-schema="schema">
    <!-- ngTemplateOutletåŸºäºå·²æœ‰çš„ TemplateRef å¯¹è±¡ï¼Œæ’å…¥å¯¹åº”çš„å†…åµŒè§†å›¾;ngTemplateOutletContextè®¾ç½® EmbeddedViewRef çš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚é€šè¿‡ let è¯­æ³•æ¥å£°æ˜ç»‘å®šä¸Šä¸‹æ–‡å¯¹è±¡å±æ€§å -->
    <!-- è¿™é‡Œçš„å°è£…å°† sf-template åŸæ¥çš„ä¸Šä¸‹æ–‡ä¿æŒä¸‹æ¥ -->
    <ng-template [ngTemplateOutlet]="item.template"
      [ngTemplateOutletContext]="{$implicit: me, schema: searchSchema, ui: searchUi }"></ng-template>
  </ng-template>
</sf>
```

```js
export class CurdListComponent implements AfterContentInit {

  ...

  /**
   * _customTemplates: å†…åµŒè§†å›¾å¯¹è±¡ï¼Œé¡¹ç›®ä¸­æŒ‡customè¡¨å•é¡¹çš„è§†å›¾å¯¹è±¡ï¼Œå› ä¸ºå¯èƒ½å‡ºç°å¤šä¸ªcustomï¼Œæ•…æ­¤å¤„è€ƒè™‘æ•°ç»„
   */
  _customTemplates: { name: string; template: TemplateRef<any> }[] = [];

  // TabletDirective æ˜¯å°è£…çš„æŒ‡ä»¤ï¼Œè§ä»£ç e
  @ContentChildren(TabletDirective) _tablets: QueryList<TabletDirective>;

  ngAfterContentInit() {
    this._tablets.forEach(tablet => {
      this._customTemplates.push({
        name: tablet.name,
        template: tablet.templateRef,
      });
    });
  }

  ...

}
```

æ–°å»ºè‡ªå®šä¹‰æŒ‡ä»¤ï¼Œç”¨äºæ¥æ”¶æŒ‡å®šç›®æ ‡çš„templateRefï¼š

```js
import { Directive, Input, TemplateRef } from '@angular/core';

@Directive({
  selector: '[btxTablet]',
})
export class TabletDirective {
  @Input('btxTablet') btxTablet: string = '';

  get name() {
    return this.btxTablet;
  }

  constructor(public templateRef: TemplateRef<any>) {}
}
```

å°è£…å®Œæˆï¼Œä½¿ç”¨ç¤ºä¾‹ï¼š

```html
<btx-curd-list #list title="æ¨¡å—ç®¡ç†"
  [url]="url"
  [columns]="columns"
  [scroll]="scroll"
  [searchSchema]="searchSchema"
  [searchUi]="searchUi"
  [service]="module"
  [editComponent]="editComponent"
  [viewComponent]="viewComponent">
  <!-- btxTabletçš„å€¼æ›¿æ¢äº†sf-templateçš„å€¼ -->
  <ng-template btxTablet="productCode" let-me let-ui="searchUi" let-schema="searchSchema">
    <nz-select [ngModel]="me.formProperty.value" (ngModelChange)="me.setValue($event)">
      <nz-option
        nzCustomContent
        *ngFor="let i of dict.productList$ | async"
        [nzLabel]="i.value"
        [nzValue]="i.value" ><span>{{i.value}} ({{i.label}})</span></nz-option>
    </nz-select>
  </ng-template>
</btx-curd-list>
```

ğŸ’¬[Angular 4.x NgTemplateOutlet](https://segmentfault.com/a/1190000009530554)

ğŸ’¬[Angular 2 ContentChild & ContentChildren](https://segmentfault.com/a/1190000008707828)
